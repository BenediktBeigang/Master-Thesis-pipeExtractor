= pipe-vector-extractor

Extraction and evaluation of pipe segments and pipe components from classified point clouds.

== Project overview

* **Pipe extraction** through Hough-based slicing, clustering, and snapping: see link:pipe_extraction/pipe_extraction_hough_parallel.py[`pipe_extraction.pipe_extraction_hough_parallel.extract_pipes`].
* **Pipe component extraction** in pipe neighbourhoods: link:pipeComponent_extraction/pipeComponentExtraction.py[`pipeComponent_extraction.pipeComponentExtraction.extract_pipeComponents`].
* **Evaluation & visualization** of metrics, plots, and OBJ/GeoJSON exports orchestrated by link:main.py[`main.main`].

[cols="1,3",options="header"]
|===
| Stage | Description
| Preprocessing | Load point cloud, initialise output directories (`prepare_output_directory` in link:util.py[`util.py`]).
| Phase 1: Approximation | Slice in Z, detect lines via Hough (`find_lines_in_slice` in link:pipe_extraction/calcSlice.py[`pipe_extraction/calcSlice.py`]).
| Phase 1b: Clustering & merging | Cluster Hough segments with DBSCAN (`cluster_segments`), merge segments (`merge_segments_in_clusters`).
| Phase 2: Snapping | Refine approximated pipes against raw points (`snap_segments_to_point_cloud_data_parallel`).
| Components | Use pipes to guide component clustering (`extract_pipeComponents`).
| Evaluation | Measure coverage and error (`pipeEval`, `componentEval`), render visualisations.
|===

== Installation and usage

[source,bash]
----
conda env create -f environment.yml
conda activate pipe-extraction

python main.py --input <filename>.las [--config_path <config>.json]
----

== Configuration

All pipeline parameters live in link:config.json[`config.json`]:

* `slice_thickness`, `hough` control slice generation and Hough detection.
* `global_cluster_and_merge` sets DBSCAN epsilon, minimum samples, and gap thresholds for global merging.
* `slice_cluster_and_merge` provides slice-specific clustering and merge settings.
* `snapping` governs sampling density, bounding boxes, and RANSAC fitting.

== Outputs

* `output/obj/*.obj` — approximated and snapped pipe segments plus bounding boxes.
* `output/geojson/*.geojson` — combined pipes and components via link:export_geojson.py[`export_geojson.export_geojson`].
* `output/metrics/*.json` — pipe and component metrics from link:eval/pipeEval.py[`eval.pipeEval.pipeEval`] and link:eval/componentEval.py[`eval.componentEval.componentEval`].
* `output/plots/*.png` — bar/box plots from link:eval/plots/pipeClassPlot.py[`eval.plots.pipeClassPlot.plot_segmentClasses`] and link:eval/plots/componentClassPlot.py[`eval.plots.componentClassPlot.plot_componentClasses`].

== Development notes

* Type hints in link:custom_types.py[`custom_types.py`] document NumPy shapes and structures.
* Experiments, prototypes and old code in link:experiments[`experiments/`]
